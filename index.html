<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEARN DSpace as a Service Request Form</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 0; padding: 20px; background-color: #f4f4f4; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 5px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        h1, h2 { color: #333; text-align: center; }
        .section { margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input[type="text"], input[type="tel"] { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .signature { font-style: italic; }
        .buttons { margin-top: 20px; text-align: center; }
        button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background-color: #45a049; }
        #signature-canvas { border: 1px solid #ccc; cursor: crosshair; }
        #success, #error { display: none; text-align: center; }
        .hidden { display: none; }
        #pdf-link { display: block; margin-top: 10px; text-align: center; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>LEARN</h1>
        <h2>DSpace as a Service</h2>
        <h3>Service Request Form</h3>
        <p>LEARN DSpace as a Service is provided as a central publication workflow management system, with individual access granted to each department for managing and depositing their publications. Separate DSpace instances are not provided but a workspace from the central system is provided for each department for production use. Workspace for testing/temporary use are not provided. The DSpace service runs on LEARN FOSS HA cloud infrastructure and comes without a Service Level Agreement (SLA), but is maintained on a best-effort basis by the LEARN engineering.</p>
        <p>All the LEARN FOSS services can be accessed from anywhere as long as you are connected to the Internet. The major local ISPs currently provide free data for accessing LEARN FOSS services when you access them from your private Internet connection.</p>
        <form id="dspace-form">
            <div class="section">
                <h3>Section 1: Faculty Information</h3>
                <div class="form-group">
                    <label for="Faculty Name">Faculty Name:</label>
                    <input type="text" id="Faculty Name" name="Faculty Name" required>
                </div>
                <h4>Department Details (Add one or more departments)</h4>
                <table id="departments-table">
                    <thead>
                        <tr>
                            <th>Department Name</th>
                            <th>Departmental Admin/Coordinator Name</th>
                            <th>Contact Number (WhatsApp)</th>
                            <th>EduID / SSO Login</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" name="Department Name[]" required></td>
                            <td><input type="text" name="Departmental Admin/Coordinator Name[]" required></td>
                            <td><input type="tel" name="Contact Number (WhatsApp)[]" required></td>
                            <td><input type="text" name="EduID / SSO Login[]" required></td>
                            <td><button type="button" class="remove-row">Remove</button></td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" id="add-row">Add Another Department</button>
            </div>
            <div class="section">
                <h3>Section 5: Declaration</h3>
                <p>I hereby certify that the above information provided is accurate and correct, and also understand the LEARN FOSS SLA terms mentioned above.</p>
                <div class="form-group">
                    <label>Signature Method:</label>
                    <div>
                        <input type="radio" id="draw-signature" name="signature-method" value="draw" checked>
                        <label for="draw-signature">Draw Signature</label>
                    </div>
                    <div>
                        <input type="radio" id="upload-signature" name="signature-method" value="upload">
                        <label for="upload-signature">Upload Signature</label>
                    </div>
                </div>
                <div id="draw-signature-section" class="form-group">
                    <label for="signature-canvas" class="signature">Draw Signature (Dean/Faculty):</label>
                    <canvas id="signature-canvas" width="300" height="100"></canvas>
                    <button type="button" id="clear-signature">Clear Signature</button>
                    <input type="hidden" id="Signature (Dean/Faculty)" name="Signature (Dean/Faculty)">
                </div>
                <div id="upload-signature-section" class="form-group hidden">
                    <label for="signature-upload" class="signature">Upload Signature (Dean/Faculty):</label>
                    <input type="file" id="signature-upload" name="signature-upload" accept="image/*">
                    <input type="hidden" id="Signature (Dean/Faculty)" name="Signature (Dean/Faculty)">
                </div>
            </div>
            <div class="buttons">
                <button type="submit">Submit to Google Sheets</button>
            </div>
        </form>
        <div id="success">Form submitted successfully! <a id="pdf-link" href="#" download="DSpace_Service_Request.pdf">Download PDF</a></div>
        <div id="error">Error submitting form. Check console for details.</div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const { jsPDF } = window.jspdf;
            // Add row to table
            const addRowButton = document.getElementById('add-row');
            if (addRowButton) {
                addRowButton.addEventListener('click', () => {
                    const tbody = document.querySelector('#departments-table tbody');
                    if (tbody) {
                        const newRow = document.createElement('tr');
                        newRow.innerHTML = `
                            <td><input type="text" name="Department Name[]" required></td>
                            <td><input type="text" name="Departmental Admin/Coordinator Name[]" required></td>
                            <td><input type="tel" name="Contact Number (WhatsApp)[]" required></td>
                            <td><input type="text" name="EduID / SSO Login[]" required></td>
                            <td><button type="button" class="remove-row">Remove</button></td>
                        `;
                        tbody.appendChild(newRow);
                        console.log('Added new department row');
                    } else {
                        console.error('Table body not found');
                    }
                });
            } else {
                console.error('Add row button not found');
            }
            // Remove row from table
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-row')) {
                    e.target.closest('tr').remove();
                    console.log('Removed department row');
                }
            });
            // Signature canvas setup
            const canvas = document.getElementById('signature-canvas');
            let signatureData = '';
            let hasDrawn = false;
            if (canvas) {
                const ctx = canvas.getContext('2d');
                let isDrawing = false;

                function getCanvasCoordinates(event) {
                    const rect = canvas.getBoundingClientRect();
                    return {
                        x: event.clientX - rect.left,
                        y: event.clientY - rect.top
                    };
                }

                canvas.addEventListener('mousedown', (e) => {
                    isDrawing = true;
                    hasDrawn = true;
                    const coords = getCanvasCoordinates(e);
                    ctx.beginPath();
                    ctx.moveTo(coords.x, coords.y);
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 2;
                    console.log('Mouse down at:', coords.x, coords.y);
                });

                canvas.addEventListener('mousemove', (e) => {
                    if (isDrawing) {
                        const coords = getCanvasCoordinates(e);
                        ctx.lineTo(coords.x, coords.y);
                        ctx.stroke();
                    }
                });

                canvas.addEventListener('mouseup', () => {
                    if (isDrawing) {
                        isDrawing = false;
                        signatureData = canvas.toDataURL('image/png');
                        const signatureInput = document.getElementById('Signature (Dean/Faculty)');
                        if (signatureInput) {
                            signatureInput.value = 'Drawn';
                            console.log('Signature captured: Drawn, Data:', signatureData.substring(0, 50) + '...');
                        }
                    }
                });

                canvas.addEventListener('mouseout', () => {
                    isDrawing = false;
                });

                canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    isDrawing = true;
                    hasDrawn = true;
                    const touch = e.touches[0];
                    const coords = getCanvasCoordinates(touch);
                    ctx.beginPath();
                    ctx.moveTo(coords.x, coords.y);
                    console.log('Touch start at:', coords.x, coords.y);
                });

                canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    if (isDrawing) {
                        const touch = e.touches[0];
                        const coords = getCanvasCoordinates(touch);
                        ctx.lineTo(coords.x, coords.y);
                        ctx.stroke();
                    }
                });

                canvas.addEventListener('touchend', () => {
                    if (isDrawing) {
                        isDrawing = false;
                        signatureData = canvas.toDataURL('image/png');
                        const signatureInput = document.getElementById('Signature (Dean/Faculty)');
                       
